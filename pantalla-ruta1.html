<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Plataforma web para encontrar las mejores rutas para explorar los mejores museos de Mallorca">

    <!-- Css -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css">
    <link rel="stylesheet" href="css/normalize.css">
    <link rel="stylesheet" href="css/styles.css">
    <link href="img/svg/light-mode-favicon.svg" rel="icon" media="(prefers-color-scheme: light)">
    <link href="img/svg/dark-mode-favicon.svg" rel="icon" media="(prefers-color-scheme: dark)">

    <script src="js/calendar.js"></script>

    <title>MallorkCultura</title>
</head>
<body>
    <header>
        <!-- Barra superior -->
        <nav id="nav-header" class="my-1">
            <div>
                <!-- Barra superior -->
                <a href="index.html" class="logo">
                    <!-- Foto de nuestro logo -->
                    <img src="img/svg/logo.svg" alt="Logo de MallorkCultura" class="logo-imagen"/>
                </a>
                <button class="menu_icon no-style-button">
                    <img src="img/svg/menu.svg" alt="Botón de menú"/>
                </button>
                <div class="nav-links-header">
                    <a href="pantalla-museos.html">¿Qué visitar?</a>
                    <a href="pantalla-ruta.html">Tu ruta</a>
                </div>
            </div>
        </nav>
        <div>
            <img src="img/ruta.webp" alt="ruta" width="100%"/>
        </div>
    </header>
    <!-- Parte inferior de la pantalla -->
    <main class="contenedor-principal ruta">
        <a class="boton-atras mt-2 ml-4" href="index.html">
            <img src="img/svg/flecha-atras.svg" alt="Botón de volver atrás" class="back-arrow">
            Atrás
        </a>
        <h2 class="mt-4">Tu ruta</h2>
        <hr class="my-4">
        <div class="contenedor-ruta-general mt-5">
            <div class="vl"></div>
            <ul class="section-ruta">
                <!-- Aquí se añadirán dinámicamente los eventos -->
            </ul>
        </div>
    </main>
    <footer class="pie-pagina">
        <hr>
        <div class="contenido-footer mb-4">
            <div class="texto-footer">
                <p id="copy-text"></p>
                <p>Todos los derechos reservados</p>
            </div>
            <a href="#">Contacto</a>
        </div>
    </footer>
    <script src="js/date.js" defer></script>
    <script>
        // Función para mostrar la ruta en la pantalla
        function mostrarRuta() {
            const eventos = recuperarVisitas();
            const contenedorRuta = document.querySelector('.section-ruta');
            
            // Limpiar el contenido existente del contenedor
            contenedorRuta.innerHTML = '';

            // Verificar si hay eventos
            if (eventos.length === 0) {
                // Si no hay eventos, mostrar un mensaje
                contenedorRuta.innerHTML = '<p>Todavía no has empezado a diseñar tu ruta</p>';
            } else {
                // Si hay eventos, mostrar cada uno en la lista
                eventos.forEach((evento, index) => {
                    const duracion = calcularDuracion(evento.horaInicio, evento.horaFin);
                    const descanso = index === eventos.length - 1 ? '' : '<div><p class="descanso">Descanso: 1h</p></div>';

                    const li = document.createElement('li');
                    li.classList.add('parada-ruta');

                    const divLeft = document.createElement('div');
                    divLeft.classList.add('left-museo-ruta');

                    const horas = document.createElement('p');
                    horas.classList.add('horas');
                    horas.textContent = `${evento.horaInicio.split('T')[1].slice(0, 5)} - ${evento.horaFin.split('T')[1].slice(0, 5)}`;
                    divLeft.appendChild(horas);

                    const circ = document.createElement('span');
                    circ.classList.add('circ');
                    divLeft.appendChild(circ);

                    li.appendChild(divLeft);

                    const divRight = document.createElement('div');

                    const h5Container = document.createElement('div');
                    h5Container.classList.add('parada-ruta','museo-container');

                    const h5 = document.createElement('h5');
                    h5.textContent = evento.lugar;

                    const botonEliminar = document.createElement('button');
                    botonEliminar.classList.add('no-style-button', 'cruz-ruta');
                    botonEliminar.setAttribute('onclick', `eliminarMuseoRuta(${index})`);
                    const imgCruz = document.createElement('img');
                    imgCruz.setAttribute('src', 'img/svg/cruz.svg');
                    imgCruz.setAttribute('alt', 'Símbolo de cruz para tachar un museo de la ruta');
                    botonEliminar.appendChild(imgCruz);

                    h5Container.appendChild(h5);
                    h5Container.appendChild(botonEliminar);

                    divRight.appendChild(h5Container);

                    const formulario = document.createElement('form');
                    formulario.classList.add('formulario-ruta');

                    const divInicio = document.createElement('div');
                    const labelInicio = document.createElement('label');
                    labelInicio.setAttribute('for', 'inicio');
                    labelInicio.textContent = 'Inicio:';
                    const selectInicio = document.createElement('select');
                    selectInicio.setAttribute('name', 'inicio');
                    const optionInicio = document.createElement('option');
                    optionInicio.textContent = evento.horaInicio.split('T')[1].slice(0, 5); // Mostrar solo hora y minutos
                    selectInicio.appendChild(optionInicio);
                    divInicio.appendChild(labelInicio);
                    divInicio.appendChild(selectInicio);

                    formulario.appendChild(divInicio);

                    const divDuracion = document.createElement('div');
                    const labelDuracion = document.createElement('label');
                    labelDuracion.setAttribute('for', 'duracion');
                    labelDuracion.textContent = 'Duración:';
                    const selectDuracion = document.createElement('select');
                    selectDuracion.setAttribute('name', 'duracion');
                    const optionDuracion = document.createElement('option');
                    optionDuracion.textContent = duracion; // Mostrar duración con minutos
                    selectDuracion.appendChild(optionDuracion);
                    divDuracion.appendChild(labelDuracion);
                    divDuracion.appendChild(selectDuracion);

                    formulario.appendChild(divDuracion);
                    divRight.appendChild(formulario);

                    

                    li.appendChild(divRight);
                    contenedorRuta.appendChild(li);
                    contenedorRuta.innerHTML += descanso;
                });
            }
        }

        // Función para calcular la duración entre dos horas
        function calcularDuracion(horaInicio, horaFin) {
            const inicio = new Date(horaInicio);
            const fin = new Date(horaFin);
            const duracionMinutos = Math.round((fin - inicio) / (1000 * 60)); // Convertir milisegundos a minutos y redondear
            return `${Math.floor(duracionMinutos / 60)}h ${duracionMinutos % 60}min`; // Mostrar duración con horas y minutos
        }

        // Función para eliminar un museo de la ruta
        function eliminarMuseoRuta(index) {
            const eventos = recuperarVisitas();
            eventos.splice(index, 1); // Eliminar el evento correspondiente al índice
            localStorage.setItem('visitas', JSON.stringify(eventos)); // Actualizar el localStorage
            mostrarRuta(); // Mostrar la ruta actualizada
        }

        // Función para recuperar las visitas guardadas en el localStorage
        function recuperarVisitas() {
            const visitas = localStorage.getItem('visitas');
            return visitas ? JSON.parse(visitas) : [];
        }

        // Cargar la ruta al cargar la página
        window.addEventListener('DOMContentLoaded', mostrarRuta);
    </script>
</body>
</html>
